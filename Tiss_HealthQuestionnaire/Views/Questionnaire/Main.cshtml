@model Tiss_HealthQuestionnaire.Models.QuestionnaireViewModel
@{
    ViewBag.Title = "Main";
    Layout = "~/Views/Shared/_HealthLayout.cshtml";
}
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>健康檢查問卷</title>
    <link href="~/css/tailwind.min.css" rel="stylesheet" />
    <link href="~/css/mainStyle.css" rel="stylesheet" />
    <link href="~/css/SymptomsLights.css" rel="stylesheet" />
    <script src="~/js/SymptomLights.js"></script>
    <script src="~/js/SymptomEvaluationScore.js"></script>
    <script src="~/js/formValidation.js"></script>
    <script src="~/js/validateFillDate.js"></script>
    <script src="~/js/injury-section.js"></script> @*傷害狀況顯示*@
</head>
<body class="bg-gray-100 p-4">
    <div class="container mx-auto">
        <form id="questionnaireForm" method="post" action="/Questionnaire/Preview">
            <input type="hidden" id="formDataJson" name="formDataJson" />

            @*基本資料*@
            <div class="bg-white p-6 rounded-lg shadow-md mb-4">
                <div class="flex flex-col md:flex-row items-center mb-4 space-x-4">
                    <label class="mr-2">
                        專項：
                        <input type="text" name="specialist" class="border rounded p-1" value="@ViewBag.Specialist" readonly />
                    </label>
                    <label class="mr-2">
                        填表人：
                        <input type="text" name="fillName" class="border rounded p-1" value="@ViewBag.FillName" readonly />
                    </label>
                    <label class="mr-2">
                        選手編號：
                        <input type="text" name="atheNum" class="border rounded p-1" value="@ViewBag.AtheNum" readonly />
                        <input type="hidden" id="athleteNumber" value="@ViewBag.AtheNum" />
                    </label>
                    <label class="mr-2">
                        性別：
                        <input type="text" name="genderDisplay" class="border rounded p-1"
                               value="@(ViewBag.GenderID == 1 ? "男" : "女")" readonly />
                        <input type="hidden" name="gender" value="@(ViewBag.GenderID)" />
                    </label>
                    <label class="mr-2">
                        填表日期：
                        <input type="date" name="fillDate" class="border rounded p-1" required />
                    </label>
                </div>
            </div>
            <div id="questionnaireSteps">
                @*過去健康檢查病史*@
                <div class="question-step bg-white p-6 rounded-lg shadow-md mb-4" data-step="1" data-section-name="過去健康檢查病史">
                    <h3 class="text-lg font-semibold mb-4">過去健康檢查病史</h3>
                    <table class="min-w-full bg-white border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 px-4 py-2">項目 Item</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">否 No</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">是 Yes</th>
                                <th class="border border-gray-300 px-4 py-2">備註 (若選 "是" 必填)</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.PastHealthItems)
                            {
                                <tr class="question-row">
                                    <td class="border border-gray-300 px-4 py-2">
                                        <span class="block font-medium">@item.ItemZh</span>
                                        <span class="block text-sm text-gray-600">@item.ItemEn</span>
                                    </td>
                                    <td class="border border-gray-300 px-4 py-2 text-center">
                                        <input type="radio" id="pastHealth_no_@item.ID" name="pastHealth_@item.ID" value="no" class="form-radio h-5 w-5 text-blue-600 required-radio">
                                        <label for="pastHealth_no_@item.ID">否</label>
                                    </td>
                                    <td class="border border-gray-300 px-4 py-2 text-center">
                                        <input type="radio" id="pastHealth_yes_@item.ID" name="pastHealth_@item.ID" value="yes" class="form-radio h-5 w-5 text-blue-600 required-radio">
                                        <label for="pastHealth_yes_@item.ID">是</label>
                                        <div id="details_@item.ID">
                                            <input type="text" name="item1_@item.ID" class="border rounded p-2 w-full required-text hidden" placeholder="請填寫...">
                                            <input type="text" name="item2_@item.ID" class="border rounded p-2 w-full required-text hidden" placeholder="請填寫...">
                                            <input type="text" name="item3_@item.ID" class="border rounded p-2 w-full required-text hidden" placeholder="請填寫...">
                                        </div>
                                    </td>

                                    <td class="border border-gray-300 px-4 py-2 text-center" style="width: 30%;">
                                        <input type="text" name="PastHealthResponses[@item.ID]" class="border rounded p-2 w-full" placeholder="選'是'請填備註">
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                @*過敏史*@
                <div class="question-step bg-white p-6 rounded-lg shadow-md mb-4 hidden" data-step="2" data-section-name="過敏史">
                    <h3 class="text-lg font-semibold mb-4">過敏史</h3>
                    <table class="min-w-full bg-white border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 px-4 py-2">項目 Item</th>
                                <th class="border border-gray-300 px-4 py-2">否 No</th>
                                <th class="border border-gray-300 px-4 py-2">是 Yes</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.AllergicHistoryItems)
                            {
                                <tr class="hover:bg-gray-100 question-row" data-type="radio">
                                    <td class="border border-gray-300 px-4 py-2">
                                        <span class="block font-medium">@item.ItemZh</span>
                                        <span class="block text-sm text-gray-600">@item.ItemEn</span>
                                    </td>
                                    <td class="border border-gray-300 px-4 py-2 text-center">
                                        <input type="radio" id="allergy_no_@item.ID" name="allergy_@item.ID" value="no" class="form-radio h-5 w-5 text-blue-600 required-radio">
                                        <label for="allergy_no_@item.ID">否</label>
                                    </td>
                                    <td class="border border-gray-300 px-4 py-2 text-center">
                                        <input type="radio" id="allergy_yes_@item.ID" name="allergy_@item.ID" value="yes" class="form-radio h-5 w-5 text-blue-600 required-radio">
                                        <label for="allergy_yes_@item.ID">是</label>
                                        <div id="details_@item.ID">
                                            <input type="text" name="details_@item.ID" class="border rounded p-2 w-full" placeholder="請描述過敏內容...">
                                        </div>
                                    </td>

                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                @*家族病史-二等親內*@
                <div class="question-step bg-white p-6 rounded-lg shadow-md mb-4 hidden" data-step="3" data-section-name="家族病史(二等親內)">
                    <h3 class="text-lg font-semibold mb-4">家族病史 - 二等親內</h3>
                    <table class="min-w-full bg-white border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 px-4 py-2">疾病項目</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">否</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">是</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">未知</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (int i = 0; i < Model.FamilyHistoryItems.Count; i++)
                            {
                                var item = Model.FamilyHistoryItems[i];
                                <tr class="question-row">
                                    <td class="border border-gray-300 px-4 py-2">@item.GeneralPartsZh</td>
                                    <td class="border border-gray-300 px-4 py-2 text-center">
                                        <input type="radio" id="family_no_@i" name="FamilyHistoryItems[@i].FamilyHistoryOption" value="no" class="w-5 h-5 required-radio">
                                    </td>
                                    <td class="border border-gray-300 px-4 py-2 text-center">
                                        <input type="radio" id="family_yes_@i" name="FamilyHistoryItems[@i].FamilyHistoryOption" value="yes" class="w-5 h-5 required-radio">
                                    </td>
                                    <td class="border border-gray-300 px-4 py-2 text-center">
                                        <input type="radio" id="family_unknown_@i" name="FamilyHistoryItems[@i].FamilyHistoryOption" value="unknown" class="w-5 h-5 required-radio">
                                    </td>
                                </tr>
                            }
                            <tr>
                                <td class="border border-gray-300 px-4 py-2 font-semibold">其他 (Others)：</td>
                                <td colspan="3" class="border border-gray-300 px-4 py-2">
                                    <input type="text" name="OtherFamilyHistory" value="@Model.OtherFamilyHistory"
                                           class="border rounded p-3 w-full w-5 h-5" placeholder="請填寫其他家族病史...">
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                @*過去病史*@
                <div class="question-step bg-white p-6 rounded-lg shadow-md mb-4 hidden" data-step="4" data-section-name="過去病史">
                    <h2 class="text-lg font-semibold mb-4">過去病史</h2>
                    <label>近六個月內是否發生過以下疾病？</label>
                    <table class="min-w-full bg-white border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 px-4 py-2">疾病項目</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">否</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">是</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">未知</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (int i = 0; i < Model.PastHistoryItems.Count; i++)
                            {
                                var item = Model.PastHistoryItems[i];
                                <tr class="question-row">
                                    <td class="border border-gray-300 px-4 py-2">@item.GeneralPartsZh</td>
                                    <td class="border border-gray-300 px-4 py-2 text-center">
                                        <input type="radio" name="PastHistoryItems[@i].PastHistoryOption" value="no" class="w-5 h-5 required-radio" />
                                    </td>
                                    <td class="border border-gray-300 px-4 py-2 text-center">
                                        <input type="radio" name="PastHistoryItems[@i].PastHistoryOption" value="yes" class="w-5 h-5 required-radio" />
                                    </td>
                                    <td class="border border-gray-300 px-4 py-2 text-center">
                                        <input type="radio" name="PastHistoryItems[@i].PastHistoryOption" value="unknown" class="w-5 h-5 required-radio" />
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>

                    <div class="mt-4">
                        <label for="OtherPastHistory">其他 (Others)：</label>
                        <input type="text" id="OtherPastHistory" name="OtherPastHistory" value="@Model.OtherPastHistory"
                               class="border rounded p-2 w-full" placeholder="請填寫其他病史...">
                    </div>

                    @for (int i = 0; i < Model.PastHistoryItems.Count; i++)
                    {
                        var item = Model.PastHistoryItems[i];
                        <input type="hidden" name="PastHistoryItems[@i].ID" value="@item.ID" />
                        <input type="hidden" name="PastHistoryItems[@i].GeneralPartsZh" value="@item.GeneralPartsZh" />
                    }
                </div>

                @*現在病史*@
                <div class="question-step bg-white p-6 rounded-lg shadow-md mb-4 hidden" data-step="5" data-section-name="現在病史">
                    <h2 class="text-lg font-semibold mb-4">現在病史</h2>
                    <table class="min-w-full bg-white border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 px-4 py-2">疾病部位</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">是否正在治療</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (int i = 0; i < Model.PresentIllnessItems.Count; i++)
                            {
                                var item = Model.PresentIllnessItems[i];
                                <tr class="question-row">
                                    <td class="border border-gray-300 px-4 py-2">@item.PartsOfBodyZh</td>
                                    <td class="border border-gray-300 px-4 py-2 text-center">
                                        <input type="radio" name="PresentIllnessItems[@i].ReceivingTherapy" value="no" class="required-radio h-5 w-5" /> 否
                                        <input type="radio" name="PresentIllnessItems[@i].ReceivingTherapy" value="yes" class="required-radio h-5 w-5" /> 是
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>

                    @for (int i = 0; i < Model.PresentIllnessItems.Count; i++)
                    {
                        var item = Model.PresentIllnessItems[i];
                        <input type="hidden" name="PresentIllnessItems[@i].ID" value="@item.ID" />
                        <input type="hidden" name="PresentIllnessItems[@i].PartsOfBodyZh" value="@item.PartsOfBodyZh" />
                    }
                </div>

                @*藥物史*@
                <div class="question-step bg-white p-6 rounded-lg shadow-md mb-4 hidden" data-step="6" data-section-name="藥物史">
                    <h2 class="text-lg font-semibold mb-4">藥物史</h2>
                    <table class="min-w-full bg-white border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 px-4 py-2">項目</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">是否使用</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (int i = 0; i < Model.PastDrugsItems.Count; i++)
                            {
                                var item = Model.PastDrugsItems[i];
                                <tr class="question-row">
                                    <td class="border border-gray-300 px-4 py-2">@item.ItemZh</td>
                                    <td class="border border-gray-300 px-4 py-2 text-center">
                                        <label>
                                            <input type="radio" name="PastDrugsItems[@i].IsUsed" value="true" class="required-radio w-5 h-5" /> 是
                                        </label>
                                        <label class="ml-4">
                                            <input type="radio" name="PastDrugsItems[@i].IsUsed" value="false" class="required-radio w-5 h-5" /> 否
                                        </label>
                                        <input type="hidden" name="PastDrugsItems[@i].ID" value="@item.ID">
                                        <input type="hidden" name="PastDrugsItems[@i].ItemZh" value="@item.ItemZh">
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>

                    <div class="mt-4 p-4 border border-gray-300 rounded-lg">
                        <label class="font-semibold">是否有申請治療用途豁免？(TUE)</label>
                        <div class="flex space-x-4 mt-2">
                            <label class="inline-flex items-center">
                                <input type="radio" name="TUE" value="yes" class="form-radio required-radio h-5 w-5"/>
                                <span class="ml-2">是</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="TUE" value="no" class="form-radio required-radio h-5 w-5" />
                                <span class="ml-2">否</span>
                            </label>
                        </div>
                    </div>
                </div>

                @*營養品*@
                <div class="question-step bg-white p-6 rounded-lg shadow-md mb-4 hidden" data-step="7" data-section-name="營養品">
                    <h2 class="text-lg font-semibold mb-4">營養品</h2>
                    <table class="min-w-full bg-white border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 px-4 py-2">項目</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">是否使用</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (int i = 0; i < Model.PastSupplementsItems.Count; i++)
                            {
                                var item = Model.PastSupplementsItems[i];
                                <tr class="question-row">
                                    <td class="border border-gray-300 px-4 py-2">@item.ItemZh</td>
                                    <td class="border border-gray-300 px-4 py-2 text-center">
                                        <label>
                                            <input type="radio" name="PastSupplementsItems[@i].IsUsed" value="true" class="required-radio w-5 h-5" /> 是
                                        </label>
                                        <label class="ml-4">
                                            <input type="radio" name="PastSupplementsItems[@i].IsUsed" value="false" class="required-radio w-5 h-5" /> 否
                                        </label>
                                        <input type="hidden" name="PastSupplementsItems[@i].ID" value="@item.ID">
                                        <input type="hidden" name="PastSupplementsItems[@i].ItemZh" value="@item.ItemZh">
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>

                    <div class="mt-4">
                        <label class="font-semibold">其他 (Others)：</label>
                        <input type="text" id="otherSupplementInput" name="OtherSupplements" class="border rounded p-2 w-full">
                    </div>
                </div>

                @*女性問卷*@
                @if (Model.FemaleQuestionnaireItems != null && Model.FemaleQuestionnaireItems.Any())
                {
                    <div class="question-step bg-white p-6 rounded-lg shadow-md mb-4 hidden" data-step="8">
                        <h2 class="text-lg font-semibold mb-4">女性問卷</h2>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-300">
                                <thead>
                                    <tr class="bg-gray-100">
                                        <th class="border border-gray-300 px-4 py-2">問題 Question</th>
                                        <th class="border border-gray-300 px-4 py-2 text-center">答案 Answer</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var question in Model.FemaleQuestionnaireItems)
                                    {
                                        <tr class="hover:bg-gray-100 question-row">
                                            <td class="border border-gray-300 px-4 py-2">
                                                <span class="block font-medium">@question.QuestionZh</span>
                                                <span class="block text-sm text-gray-600">@question.QuestionEn</span>
                                            </td>
                                            <td class="border border-gray-300 px-4 py-2 text-center">
                                                @if (question.ID == 1)
                                                {
                                                    <select name="FemaleQuestionnaireAnswers[@question.ID]" class="required-select border rounded px-2 py-1">
                                                        <option value="">請選擇</option>
                                                        <option value="10">10 歲(含)以下</option>
                                                        <option value="11">11 歲</option>
                                                        <option value="12">12 歲</option>
                                                        <option value="13">13 歲</option>
                                                        <option value="14">14 歲</option>
                                                        <option value="15">15 歲</option>
                                                        <option value="16">16 歲(含)以上</option>
                                                    </select>
                                                }
                                                else if (question.ID == 2 || question.ID == 4)
                                                {
                                                    <label>
                                                        <input type="radio" name="FemaleQuestionnaireAnswers[@question.ID]" value="yes" class="required-radio h-5 w-5"> 是
                                                    </label>
                                                    <label class="ml-2">
                                                        <input type="radio" name="FemaleQuestionnaireAnswers[@question.ID]" value="no" class="required-radio h-5 w-5"> 否
                                                    </label>
                                                }
                                                else if (question.ID == 3)
                                                {
                                                    <label>
                                                        <input type="radio" name="FemaleQuestionnaireAnswers[@question.ID]" value="yes" class="required-radio h-5 w-5"> 是
                                                    </label>
                                                    <label class="ml-2">
                                                        <input type="radio" name="FemaleQuestionnaireAnswers[@question.ID]" value="no" class="required-radio h-5 w-5"> 否
                                                    </label>
                                                    <label class="ml-2">
                                                        <input type="radio" name="FemaleQuestionnaireAnswers[@question.ID]" value="none" class="required-radio h-5 w-5"> 目前無生理週期
                                                    </label>
                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                }

                @*過去傷害(已復原)*@
                <div class="question-step bg-white p-6 rounded-lg shadow-md mb-4" data-step="9" data-section-name="過去傷害(已復原)">
                    <h1 class="text-lg font-semibold mb-4">過去傷害狀況 (已復原)</h1>
                    <label>
                        <input type="radio" name="pastInjuryStatus" class="required-radio h-5 w-5" value="no">
                        無 (若勾無，以下不必填寫)
                    </label>
                    <label>
                        <input type="radio" name="pastInjuryStatus" class="required-radio h-5 w-5" value="yes">
                        有，請勾選過去傷害記錄
                    </label>

                    <div id="pastInjuryDetailSection" class="hidden mt-4">
                        <!-- 受傷部位 -->
                        <div class="mt-4">
                            <h3 class="text-lg font-semibold">受傷部位</h3>
                            <table class="w-full border">
                                <thead>
                                    <tr>
                                        <th class="border p-2">部位</th>
                                        <th class="border p-2">左</th>
                                        <th class="border p-2">右</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.PastInjuryItems)
                                    {
                                        <tr>
                                            <td class="border p-2">@item.PastInjuryPart</td>
                                            <td class="border p-2">
                                                <input type="checkbox" class="pastInjury-injury-part-checkbox h-5 w-5" name="PastInjuryLeft" value="@item.Id">
                                            </td>
                                            <td class="border p-2">
                                                <input type="checkbox" class="pastInjury-injury-part-checkbox h-5 w-5" name="PastInjuryRight" value="@item.Id">
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>

                        <!-- 傷勢類型 -->
                        <div class="mt-4 hidden" id="pastInjuryTypeSection">
                            <h3 class="text-lg font-semibold">傷勢類型</h3>
                            <div class="grid grid-cols-2 gap-4">
                                @foreach (var injury in Model.PastInjuryTypes)
                                {
                                    <label class="block border p-2 rounded shadow-sm">
                                        <input type="checkbox" class="required-checkbox pastInjury-injury-type-checkbox h-5 w-5" name="SelectedInjuryTypes" value="@injury.InjuryName">
                                        @injury.InjuryName
                                    </label>
                                }
                            </div>
                        </div>

                        <!-- 治療方式 -->
                        <div class="mt-4 hidden" id="pastInjuryTreatmentSection">
                            <h3 class="text-lg font-semibold">治療方式</h3>
                            <div class="grid grid-cols-2 gap-4">
                                @foreach (var treatment in Model.PastTreatmentItems)
                                {
                                    <label class="block border p-2 rounded shadow-sm">
                                        <input type="checkbox" class="required-checkbox h-5 w-5" name="SelectedTreatmentMethods" value="@treatment.Method">
                                        @treatment.Method
                                    </label>
                                }
                            </div>
                        </div>
                    </div>
                </div>

                @*目前傷害狀況*@
                <div class="question-step bg-white p-6 rounded-lg shadow-md mb-4" data-step="10" data-section-name="目前傷害狀況">
                    <h1 class="text-lg font-semibold mb-4">目前傷害狀況</h1>
                    <label>
                        <input type="radio" name="currentInjuryStatus" class="required-radio h-5 w-5" value="no">
                        無 (若勾無，以下不必填寫)
                    </label>
                    <label>
                        <input type="radio" name="currentInjuryStatus" class="required-radio h-5 w-5" value="yes">
                        有，請勾選目前傷害記錄
                    </label>

                    <div id="currentInjuryDetailSection" class="hidden mt-4">
                        <!-- 受傷部位 -->
                        <div class="mt-4">
                            <h3 class="text-lg font-semibold">受傷部位</h3>
                            <table class="w-full border">
                                <thead>
                                    <tr>
                                        <th class="border p-2">部位</th>
                                        <th class="border p-2">左</th>
                                        <th class="border p-2">右</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.CurrentInjuryItems)
                                    {
                                        <tr>
                                            <td class="border p-2">@item.CurrentInjuryPart</td>
                                            <td class="border p-2">
                                                <input type="checkbox" class="required-checkbox currentInjury-injury-part-checkbox h-5 w-5" name="CurrentInjuryLeft" value="@item.Id">
                                            </td>
                                            <td class="border p-2">
                                                <input type="checkbox" class="required-checkbox currentInjury-injury-part-checkbox h-5 w-5" name="CurrentInjuryRight" value="@item.Id">
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>

                        <!-- 傷勢類型 -->
                        <div class="mt-4 hidden" id="currentInjuryTypeSection">
                            <h3 class="text-lg font-semibold">傷勢類型</h3>
                            <div class="grid grid-cols-2 gap-4">
                                @foreach (var injury in Model.CurrentInjuryTypes)
                                {
                                    <label class="block border p-2 rounded shadow-sm">
                                        <input type="checkbox" class="required-checkbox currentInjury-injury-type-checkbox h-5 w-5" name="SelectedCurrentInjuryTypes" value="@injury.InjuryName">
                                        @injury.InjuryName
                                    </label>
                                }
                            </div>
                        </div>

                        <!-- 治療方式 -->
                        <div class="mt-4 hidden" id="currentInjuryTreatmentSection">
                            <h3 class="text-lg font-semibold">治療方式</h3>
                            <div class="grid grid-cols-2 gap-4">
                                @foreach (var treatment in Model.CurrentTreatmentItems)
                                {
                                    <label class="block border p-2 rounded shadow-sm">
                                        <input type="checkbox" class="required-checkbox h-5 w-5" name="SelectedCurrentTreatmentMethods" value="@treatment.Method">
                                        @treatment.Method
                                    </label>
                                }
                            </div>
                        </div>
                    </div>
                </div>

                @*心血管篩檢*@
                <div class="question-step bg-white p-6 rounded-lg shadow-md mb-4 hidden" data-step="11" data-section-name="心血管篩檢">
                    <h2 class="text-lg font-semibold mb-4">心血管篩檢</h2>
                    <table class="min-w-full bg-white border border-gray-300">
                        <thead>
                            <tr>
                                <th class="border border-gray-300 px-4 py-2">問題</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">是否曾有發生過</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (int i = 0; i < Model.CardiovascularScreeningItems.Count; i++)
                            {
                                var item = Model.CardiovascularScreeningItems[i];
                                <tr class="question-row">
                                    <td class="border border-gray-300 px-4 py-2">@item.Question</td>
                                    <td class="border border-gray-300 px-4 py-2 text-center">
                                        <label>
                                            <input type="radio" name="CardiovascularScreeningItems[@i].IsUsed" value="true" class="required-radio w-5 h-5" /> 是
                                        </label>
                                        <label class="ml-4">
                                            <input type="radio" name="CardiovascularScreeningItems[@i].IsUsed" value="false" class="required-radio w-5 h-5" /> 否
                                        </label>
                                        <input type="hidden" name="CardiovascularScreeningItems[@i].ID" value="@item.ID">
                                        <input type="hidden" name="CardiovascularScreeningItems[@i].ItemZh" value="@item.Question">
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                @*腦震盪篩檢-選手自填-(1)*@
                <div class="question-step bg-white p-6 rounded-lg shadow-md mb-4 hidden" data-step="12" data-section-name="腦震盪篩檢-選手自填">
                    <h2 class="text-lg font-semibold mb-2">腦震盪篩檢</h2>
                    <h2 class="text-lg font-semibold mb-4">選手背景:您是否曾經有下列病史(症狀)</h2>
                    <table class="min-w-full bg-white border border-gray-300">
                        <thead>
                            <tr>
                                <th class="border border-gray-300 px-4 py-2 text-center">項次</th>
                                <th class="border border-gray-300 px-4 py-2">問題</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">有</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">無</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.ConcussionScreeningItems)
                            {
                                <tr class="question-row">
                                    <td class="border border-gray-300 px-4 py-2 text-center">@item.Id</td>
                                    <td class="border border-gray-300 px-4 py-2">@item.Question</td>
                                    <td class="border border-gray-300 px-4 py-2 text-center">
                                        <input type="radio" name="ConcussionQuestion_@item.Id" value="yes" class="form-radio h-5 w-5 text-blue-600 required-radio">
                                    </td>
                                    <td class="border border-gray-300 px-4 py-2 text-center">
                                        <input type="radio" name="ConcussionQuestion_@item.Id" value="no" class="form-radio h-5 w-5 text-blue-600 required-radio">
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                    @for (int i = 0; i < Model.ConcussionScreeningItems.Count; i++)
                    {
                        var item = Model.ConcussionScreeningItems[i];
                        <input type="hidden" name="ConcussionScreeningItems[@i].Id" value="@item.Id" />
                    }
                    <!-- 服用藥物及備註 -->
                    <div class="mt-4">
                        <div class="flex items-center">
                            <label class="mr-4 font-medium">● 現在是否服用藥物：</label>
                            <label class="inline-flex items-center mr-4">
                                <input type="radio" name="Medication" value="no" class="form-radio h-5 w-5 text-blue-600 required-radio">
                                <span class="ml-2">無</span>
                            </label>
                            <label class="inline-flex items-center mr-4">
                                <input type="radio" name="Medication" value="yes" class="form-radio h-5 w-5 text-blue-600 required-radio">
                                <span class="ml-2">有</span>
                            </label>
                            <span class="ml-2">(請述明)</span>
                            <input type="text" name="MedicationDetails" class="border border-gray-300 rounded px-2 py-1 w-64 ml-2">
                        </div>
                        <div class="flex items-start mt-4">
                            <label class="mr-4 font-medium">● 備註：</label>
                            <input type="text" name="Notes" class="border border-gray-300 rounded w-96 px-2 py-1">
                        </div>
                    </div>
                </div>

                @*症狀自我評估-選手自填(2)*@
                <div class="question-step bg-white p-6 rounded-lg shadow-md mb-4 hidden" data-step="13" data-section-name="症狀自我評估-選手自填(2)">
                    <h2 class="text-lg font-semibold mb-4">症狀自我評估-(0分沒有症狀，6分症狀嚴重)</h2>
                    <table class="min-w-full bg-white border border-gray-300 text-center">
                        <thead>
                            <tr>
                                <th class="border border-gray-300 px-4 py-2">燈號</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">項次</th>
                                <th class="border border-gray-300 px-4 py-2">症狀</th>
                                @for (int i = 0; i <= 6; i++)
                                {
                                    <th class="border border-gray-300 px-4 py-2">@i</th>
                                }
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.SymptomEvaluationItems)
                            {
                                <tr class="question-row">
                                    <!-- 燈號顯示 -->
                                    <td class="border border-gray-300 px-4 py-2">
                                        <span class="light-indicator" id="indicator_@item.ID"></span>
                                    </td>

                                    <!-- 項次 -->
                                    <td class="border border-gray-300 px-4 py-2 text-center">@item.ID</td>

                                    <!-- 症狀 -->
                                    <td class="border border-gray-300 px-4 py-2">@item.SymptomItem</td>

                                    <!-- 分數選項 -->
                                    @for (int i = 0; i <= 6; i++)
                                    {
                                        <td class="border border-gray-300 px-4 py-2">
                                            <input type="radio" name="SymptomScore_@item.ID" value="@i"
                                                   class="form-radio h-5 w-5 text-blue-600 score-option
                    required-radio" data-indicator="#indicator_@item.ID">
                                        </td>
                                    }
                                </tr>
                            }
                        </tbody>
                    </table>
                    @for (int i = 0; i < Model.SymptomEvaluationItems.Count; i++)
                    {
                        var item = Model.SymptomEvaluationItems[i];
                        <input type="hidden" name="SymptomEvaluationItems[@i].ID" value="@item.ID" />
                    }
                    <!-- 總計 -->
                    <div class="flex flex-col mt-4 space-y-2">
                        <div class="flex items-center">
                            <span class="mr-2 text-lg font-semibold">●</span>
                            <span class="mr-2">症狀總數：</span>
                            <span id="TotalSymptoms" class="border-b border-dotted text-lg font-semibold">0</span>
                        </div>
                        <div class="flex items-center">
                            <span class="mr-2 text-lg font-semibold">●</span>
                            <span class="mr-2">症狀分數：</span>
                            <span id="TotalScore" class="border-b border-dotted text-lg font-semibold">0</span>
                        </div>
                    </div>
                </div>

                @*骨科篩檢*@
                <div class="question-step bg-white p-6 rounded-lg shadow-md mb-4 hidden" data-step="14" data-section-name="骨科篩檢">
                    <h2 class="text-lg font-semibold mb-4">骨科篩檢</h2>
                    <table class="min-w-full bg-white border border-gray-300 text-center">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 px-4 py-2 text-center">項次</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">指示操作</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">觀察重點</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">結果</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (int i = 0; i < Model.OrthopaedicScreeningItems.Count; i++)
                            {
                                var item = Model.OrthopaedicScreeningItems[i];
                                <tr>
                                    <td class="border border-gray-300 px-4 py-2 text-center">@item.ID</td>
                                    <td class="border border-gray-300 px-4 py-2">@item.Instructions</td>
                                    <td class="border border-gray-300 px-4 py-2">@item.ObservationPoints</td>
                                    <td class="border border-gray-300 px-4 py-2">
                                        <label class="inline-flex items-center">
                                            <input type="radio" name="OrthopaedicScreeningItems[@i].Result" value="normal" class="w-5 h-5 required-radio" />
                                            <span class="ml-2">@item.ResultNormal</span>
                                        </label>
                                        <label class="inline-flex items-center ml-4">
                                            <input type="radio" name="OrthopaedicScreeningItems[@i].Result" value="abnormal" class="w-5 h-5 required-radio" />
                                            <span class="ml-2">@item.ResultAbnormal</span>
                                        </label>
                                        <input type="hidden" name="OrthopaedicScreeningItems[@i].ID" value="@item.ID" />
                                        <input type="hidden" name="OrthopaedicScreeningItems[@i].Instructions" value="@item.Instructions" />
                                        <input type="hidden" name="OrthopaedicScreeningItems[@i].ObservationPoints" value="@item.ObservationPoints" />

                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="flex justify-between mt-6">
                <button type="button" id="prevButton" class="hidden bg-pink-500 text-white px-4 py-2 rounded">上一步</button>
                <button type="button" id="nextButton" class="bg-green-500 text-white px-4 py-2 rounded">下一步</button>
                <button type="submit" id="submitButton" class="hidden bg-blue-500 text-white px-4 py-2 rounded">送出預覽</button>
            </div>
        </form>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let currentStep = 1;
            const steps = document.querySelectorAll(".question-step");
            const prevButton = document.getElementById("prevButton");
            const nextButton = document.getElementById("nextButton");
            const submitButton = document.getElementById("submitButton");
            const form = document.getElementById("questionnaireForm");

            function showStep(step) {
                steps.forEach((stepDiv, index) => {
                    stepDiv.classList.toggle("hidden", index + 1 !== step);
                });
                prevButton.classList.toggle("hidden", step === 1);
                nextButton.classList.toggle("hidden", step === steps.length);
                submitButton.classList.toggle("hidden", step !== steps.length);
            }

            function clearValidationErrors() {
                document.querySelectorAll(".border-red-500").forEach(el => el.classList.remove("border-red-500"));
            }

            submitButton.addEventListener("click", function (e) {
                if (typeof validateAllSteps === 'function' && !validateAllSteps()) {
                    e.preventDefault();
                } else {
                    form.submit();
                }
            });

            prevButton.addEventListener("click", function () {
                if (currentStep > 1) {
                    currentStep--;
                    showStep(currentStep);
                }
            });

            nextButton.addEventListener("click", function () {
                if (currentStep < steps.length) {
                    currentStep++;
                    showStep(currentStep);
                }
            });

            submitButton.addEventListener("click", function (e) {
                if (!validateAllSteps()) {
                    e.preventDefault();
                } else {
                    form.submit();
                }
            });

            showStep(currentStep);

            InjurySectionHandler.init("pastInjury");
            InjurySectionHandler.init("currentInjury");
        });
    </script>

</body>
</html>